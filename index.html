<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <title>Screenio</title>
  <meta name="description" content="Compare how different screen sizes and PPI compares to eachother">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="theme-color" content="#fafafa">
</head>

<body>
  <select class="display-selector-js">
    <option value="49-5120:1440">49" 5120x1440px</option>
    <option value="32-3840:2160" selected>32" 3840x2160px</option>
    <option value="32-2560:1440">32" 2560x1440px</option>
    <option value="24-2560:1440">24" 2560x1440px</option>
    <option value="24-1920:1080">24" 1920x1080px</option>
  </select>
  <select class="display-selector-js">
    <option value="49-5120:1440">49" 5120x1440px</option>
    <option value="32-3840:2160">32" 3840x2160px</option>
    <option value="32-2560:1440">32" 2560x1440px</option>
    <option value="24-2560:1440" selected>24" 2560x1440px</option>
    <option value="24-1920:1080">24" 1920x1080px</option>
  </select>
  <svg id="render" width="70%" style="margin: 2rem">
  </svg>
  <pre id="output"></pre>
  <script>

    const physicalScale = 100;
    const chromeRadius = 50;

    /*
     * Calculates the PPI and scaled size of a size:resolution combo.
     */
    function getDisplayScaleProperties(input) {
      const resolutionPxHypothenuse = Math.sqrt(Math.pow(input.resolutionPx.height, 2) + Math.pow(input.resolutionPx.width, 2));
      const ppi = resolutionPxHypothenuse / input.physicalIn.hypothenuse;
      return {
        ppi,
        scaledPx: {
          // TODO: Currently this gives different sizes for the same screen size
          width: Math.round(input.resolutionPx.width / ppi * physicalScale),
          height: Math.round(input.resolutionPx.height / ppi * physicalScale)
        }
      }
    }

    /*
     * Takes a string of format {inches}-{resX}:{resY}. Example: 24-1920:1080
     */
    function parseDisplayString(displayString) {
      const sizeTokenPosition = displayString.indexOf('-');
      const resolutionTokenPosition = displayString.indexOf(':');
      return {
        physicalIn: {
          hypothenuse: displayString.substring(0, sizeTokenPosition)
        },
        resolutionPx: {
          width: displayString.substring(sizeTokenPosition + 1, resolutionTokenPosition),
          height: displayString.substring(resolutionTokenPosition + 1)
        }
      };
    }

    function getRenderSize(displays) {
      return {
        width: Math.max(...displays.map(x => x.scaledPx.width)),
        height: Math.max(...displays.map(x => x.scaledPx.height))
      }
    }
    
    function getRelativeObjectResolutionSizeSize(displays) {
      const leastResolutionHeight = Math.min(...displays.map(x => x.resolutionPx.height));
      // Assume that a displays width is always greater than its height
      return {
        height: leastResolutionHeight / 3
      };
    }

    function renderDisplay(display, color, renderSize) {
      const g = document.createElementNS('http://www.w3.org/2000/svg', "g");
      g.setAttribute('fill', color);

      const chrome = document.createElementNS('http://www.w3.org/2000/svg', "path");
      const h = display.scaledPx.height;
      const w = display.scaledPx.width;
      const r = chromeRadius;
      // originX gets an extra "+ r" as we need to make room for the closing q.
      const originX = ((renderSize.width - display.scaledPx.width) / 2) + r;
      const originY = ((renderSize.height - display.scaledPx.height) / 2);
      chrome.setAttribute('d', `
      M${originX} ${originY}
      l ${w} 0
      q ${r},0 ${r},${r}
      l0 ${h}
      q 0,${r} -${r},${r}
      l-${w} 0
      q -${r},0 -${r},-${r}
      l0 -${h}
      q0,-${r} ${r},-${r}`);
      chrome.style = 'opacity: 0.5';
      
      const rect = document.createElementNS('http://www.w3.org/2000/svg', "rect");
      rect.setAttribute('width', display.scaledPx.width);
      rect.setAttribute('height', display.scaledPx.height);
      rect.setAttribute('x', ((renderSize.width - display.scaledPx.width) / 2) + r);
      rect.setAttribute('y', ((renderSize.height - display.scaledPx.height) / 2) + r);
      rect.style = 'opacity: 0.5';
      
      
      g.appendChild(chrome);
      g.appendChild(rect);
      
      return g;
    }
    
    function renderRelativeObject(display, relativeObjectSize, color) {
      const relativeObject = document.createElementNS('http://www.w3.org/2000/svg', "text");
      relativeObject.innerHTML = 'A';
      relativeObject.setAttribute('x', '50%');
      relativeObject.setAttribute('y', '50%');
      relativeObject.setAttribute('dominant-baseline', 'middle');
      relativeObject.setAttribute('text-anchor', 'middle');
      relativeObject.style = `fill: ${color}; font-size: ${relativeObjectSize.height / display.ppi * physicalScale}px`;

      return relativeObject;
    }

    function renderDisplays(displaySelects, svg, output) {
      // Calculate the properties for the listed displays
      const displays = displaySelects
        .map(x => parseDisplayString(x.value))
        .map(x => ({
          ...getDisplayScaleProperties(x),
          ...x
        }));

      // Output the calculated display properties for debug purposes
      output.innerHTML = JSON.stringify(displays, null, 2);

      // Clear the render svg
      
      // Set the render size of the svg
      const renderSize = getRenderSize(displays);
      const relativeObjectSize = getRelativeObjectResolutionSizeSize(displays);
      
      svg.innerHTML = '';
      svg.setAttribute('viewBox', `0 0 ${renderSize.width + (2 * chromeRadius)} ${renderSize.height + (2 * chromeRadius)}`);

      displays.forEach((display, i) => {
        svg.appendChild(renderDisplay(display, colors[i], renderSize));
      });
      displays.forEach((display, i) => {
        svg.appendChild(renderRelativeObject(display, relativeObjectSize, colors[i]));
      });
    }

    const colors = [
      'red',
      'blue',
      'green',
      'yellow'
    ];

    const displaySelects = Array.from(document.getElementsByClassName('display-selector-js'));

    const output = document.getElementById('output');
    const svg = document.getElementById('render');

    renderDisplays(displaySelects, svg, output);

    displaySelects.forEach(displaySelect => {
      displaySelect.addEventListener('change', () => renderDisplays(displaySelects, svg, output));
    });

  </script>
</body>

</html>